<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>Plant Identification Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #121212;
      color: #e0e0e0;
      margin: 0;
      padding: 20px;
    }

    h1 {
      color: #90caf9;
    }

    #plant-container {
      display: inline-block;
      overflow: hidden;
      border: 2px solid #555;
      border-radius: 10px;
      background-color: #1e1e1e;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
    }

    #plant-image {
      width: auto;
      max-height: 60vh;
      max-width: 90vw;
      object-fit: contain;
      margin: 10px auto;
      display: block;
      transition: transform 0.2s ease;
    }


    #input-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      margin: 10px auto;
      flex-wrap: nowrap;
      width: 100%;
      max-width: 400px;
    }

    #input-container input {
      flex: 1;
      min-width: 0;
      padding: 8px;
      font-size: 16px;
      border: 2px solid #555;
      border-radius: 5px;
      background-color: #1e1e1e;
      color: #e0e0e0;
    }

    #input-container button {
      padding: 8px 14px;
      font-size: 15px;
      border: none;
      border-radius: 5px;
      background-color: #1976d2;
      color: white;
      cursor: pointer;
      white-space: nowrap;
    }

    #input-container button:hover {
      background-color: #1565c0;
    }

    /* üîπ M√≤bil: mantenir sempre inline */
    @media (max-width: 480px) {
      #input-container {
        flex-direction: row;
        width: 95%;
        max-width: 340px;
      }

      #input-container input {
        font-size: 14px;
        padding: 6px;
      }

      #input-container button {
        font-size: 14px;
        padding: 6px 10px;
      }
    }



    button:hover {
      background-color: #1565c0;
    }

    #deck-select {
      font-size: 18px;
      padding: 5px 10px;
      border-radius: 5px;
      background-color: #1e1e1e;
      color: #e0e0e0;
      border: 2px solid #555;
      margin-top: 10px;
    }

    #result {
      font-size: 22px;
      font-weight: bold;
      margin-top: 15px;
    }

    .sci-name {
      color: #ffffff;
      font-weight: bold;
    }

    .common-name {
      color: #81c784;
      font-style: italic;
      margin-left: 10px;
    }

    #scoreboard {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin: 15px 0;
      font-size: 15px;
    }

    #scoreboard .stat {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 6px;
      font-weight: 600;
      background-color: #1e1e1e;
    }

    .correct {
      color: #4caf50;
      border: 1px solid #4caf50;
    }

    .wrong {
      color: #f44336;
      border: 1px solid #f44336;
    }

    .cycles {
      color: #8bc34a;
      border: 1px solid #8bc34a;
    }

    .deck {
      color: #ffb300;
      border: 1px solid #ffb300;
    }

    @media (max-width: 480px) {
      #scoreboard {
        font-size: 13px;
        gap: 6px;
      }

      #scoreboard .stat {
        padding: 3px 6px;
      }
    }



    #summary {
      font-size: 20px;
      font-weight: bold;
      margin-top: 20px;
      color: #ffeb3b;
    }

    #plant-list {
      position: fixed;
      right: 10px;
      top: 80px;
      width: 250px;
      max-height: 80vh;
      overflow-y: auto;
      background-color: #1e1e1e;
      border: 2px solid #555;
      border-radius: 8px;
      padding: 10px;
      font-size: 14px;
      text-align: left;
    }

    #plant-list h2 {
      color: #90caf9;
      font-size: 16px;
      margin-top: 0;
    }

    #plant-list ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    #plant-list li {
      margin: 4px 0;
    }

    #plant-list li.completed {
      text-decoration: line-through;
      color: #888;
    }

    @media (max-width: 768px) {
      #plant-list {
        position: static;
        width: 100%;
        max-height: none;
        margin-top: 10px;
      }

      #plant-list ul {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
      }

      #plant-list li {
        margin: 4px;
        font-size: 12px;
      }
    }

    #welcome-message {
      position: fixed;
      top: 45%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: #ffeb3b;
      font-size: 22px;
      font-weight: bold;
      padding: 14px 22px;
      border-radius: 10px;
      text-align: center;
      z-index: 9999;
      opacity: 0;
      animation: fadeInOut 2.5s ease-in-out forwards;
      line-height: 1.4;
      box-shadow: 0 0 10px rgba(255, 235, 59, 0.4);
    }

    @media (max-width: 480px) {
      #welcome-message {
        font-size: 18px;
        padding: 12px 18px;
        width: 80%;
        line-height: 1.3;
      }
    }

    @keyframes fadeInOut {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.9);
      }

      10% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }

      90% {
        opacity: 1;
      }

      100% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.95);
      }
    }

    h1:hover,
    #plant-list li:hover {
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div id="welcome-message">‚ú® Escriu o selecciona la planta ‚ú®</div>

  <h1>üå± Plant game</h1>

  <select id="deck-select" onchange="selectDeck()">
    <option value="deck1">Listat 1</option>
    <option value="deck2">Listat 2</option>
    <option value="deck3">Listat 3</option>
    <option value="deck4">Listat 4</option>

  </select>

  <div id="scoreboard">
    <div class="stat correct">‚úÖ <span id="correct-count">0</span></div>
    <div class="stat wrong">‚ùå <span id="wrong-count">0</span></div>
    <div class="stat cycles">‚ôªÔ∏è <span id="cycle-count">0</span></div>
    <div class="stat deck">üÉè List: <span id="deck-name">2</span></div>
  </div>



  <div id="plant-container">
    <img id="plant-image" src="" alt="plant" />
  </div>
  <br />
  <div id="input-container">
    <input type="text" id="guess" placeholder="Type the name..." />
    <button id="action-button" onclick="checkOrNext()">Continue</button>
  </div>

  <p id="result"></p>
  <p id="summary"></p>

  <div id="plant-list">
    <h2>üëá Selecciona la planta:</h2>
    <ul id="plant-items"></ul>
  </div>

  <script>

    const decks = {
      deck1: [
        "abeliaxgrandiflora",
        "acanthus mollis",
        "acca sellowiana",
        "acer monspessulanum",
        "agapanthus africanus",
        "albizia julibrissin",
        "arbutus unedo",
        "asparagus densiflorus",
        "aucuba japonica",
        "bergenia crassifolia",
        "bougainvillea glabra",
        "brachychiton populneus",
        "buxus sempervirens",
        "calendula officinalis",
        "callistemon citrinus",
        "catalpa bignonioides",
        "cedrus deodara",
        "celtis australis",
        "ceratonia siliqua",
        "cercis siliquastrum",
        "chamaerops humilis",
        "cistus monspeliensis",
        "citrus aurantium",
      ],
      deck2: [
        "convolvulus cneorum",
        "coronilla glauca",
        "cotoneaster pannosus",
        "crataegus monogyna",
        "cupressus sempervirens",
        "cyclamen persicum",
        "cynodon dactylon",
        "cyperus involucratus",
        "cyrtomium falcatum",
        "elaeagnus x ebbingei",
        "erigeron karvinskianus",
        "escallonia rubra"
      ],
      deck3: [],
      deck4: [],
    };

    const plants = {
      abeliaxgrandiflora: ["AbeliaXgrandiflora.png", "abelia2.png"],
      "acanthus mollis": ["Acanthus_mollis.png", "acant2.png"],
      "acca sellowiana": [
        "Acca_sellowiana.png",
        "feijoa-acca-sellowiana-semillas.png",
        "feijoa.png",
      ],
      "acer monspessulanum": ["Acer_monspessulanum.png", "acer2.png"],
      "agapanthus africanus": ["Agapanthus africanus.png"],
      "albizia julibrissin": ["Albizia julibrissin.png", "albizia2.png"],
      "arbutus unedo": ["arbutus unedo.png", "arbutusunedo2.png"],
      "asparagus densiflorus": [
        "Asparagus densiflorus.png",
        "asparagus2.png",
      ],
      "aucuba japonica": ["Aucuba japonica.png"],
      "bergenia crassifolia": ["Bergenia crassifolia.png", "Bergenia2.png"],
      "bougainvillea glabra": [
        "Bougainvillea glabra.png",
        "bougainvillea2.png",
      ],
      "brachychiton populneus": [
        "Brachychiton populneus.png",
        "Brachychiton2.png",
        "Brachychiton3.png",
      ],
      "buxus sempervirens": [
        "Buxus sempervirens.png",
        "buxus2.png",
        "buxus3.png",
      ],
      "calendula officinalis": [
        "Calendula officinalis.png",
        "Calendula2.png",
      ],
      "callistemon citrinus": [
        "Callistemon citrinus.png",
        "Callistemon2.png",
      ],
      "catalpa bignonioides": [
        "Catalpa bignonioides.png",
        "Catalpa2.png",
        "Catalpa3.png",
      ],
      "cedrus deodara": ["Cedrus deodara.png", "Cedrus2.png"],
      "celtis australis": ["Celtis australis.png", "Celtis2.png"],
      "ceratonia siliqua": ["Ceratonia siliqua.png", "Ceratonia2.png"],
      "cercis siliquastrum": [
        "Cercis siliquastrum.png",
        "Cercis2.png",
        "Cercis3.png",
      ],
      "chamaerops humilis": ["Chamaerops humilis.png"],
      "cistus monspeliensis": ["Cistus monspeliensis.png", "Cistus2.png"],
      "citrus aurantium": ["Citrus aurantium.png", "Citrus2.png"],
      // 2nd deck:
      "convolvulus cneorum": ["Convolvulus cneorum.png", "Convolvulus2.png"],
      "coronilla glauca": ["Coronilla glauca.png", "Coronilla2.png"],
      "cotoneaster pannosus": [
        "Cotoneaster pannosus.png",
        "Cotoneaster2.png",
      ],
      "crataegus monogyna": ["Crataegus monogyna.png", "Crataegus2.png"],
      "cupressus sempervirens": ["Cupressus sempervirens.png"],
      "cyclamen persicum": ["Cyclamen persicum.png"],
      "cynodon dactylon": ["Cynodon dactylon.png"],
      "cyperus involucratus": ["Cyperus involucratus.png"],
      "cyrtomium falcatum": ["Cyrtomium falcatum.png", "Cyrtomium2.png"],
      "elaeagnus x ebbingei": ["Elaeagnus x ebbingei.png"],
      "erigeron karvinskianus": ["Erigeron karvinskianus.png"],
      "escallonia rubra": ["Escallonia rubra.png", "Escallonia2.png"],
    };

    // Noms comuns en catal√†/castell√†
    const commonNames = {
      abeliaxgrandiflora: "Ab√®lia",
      "acanthus mollis": "Acant de fulla ampla",
      "acca sellowiana": "Feijoa",
      "acer monspessulanum": "Aur√≥ negre",
      "agapanthus africanus": "Agapant",
      "albizia julibrissin": "Ac√†cia de Constantinoble / √Årbol de la seda",
      "arbutus unedo": "Cireretes de pastor / Madro√±o",
      "asparagus densiflorus": "Esparraguera de jard√≠",
      "aucuba japonica": "Llorer tacat",
      "bergenia crassifolia": "Berg√®nia / Hortensia de invierno",
      "bougainvillea glabra": "Buguenv√≠l¬∑lea / Buganvilla com√∫n",
      "brachychiton populneus": "Arbre ampolla / √Årbol botella",
      "buxus sempervirens": "Boix com√∫ / Boj",
      "calendula officinalis": "Cal√®ndula / Boixac Anual / Flamenquilla",
      "callistemon citrinus": "Escura-xemeneies / Limpiatubos",
      "catalpa bignonioides": "Catalpa",
      "cedrus deodara": "Cedre de l'Him√†laia",
      "celtis australis": "Lledoner / Almer",
      "ceratonia siliqua": "Garrofer / Algarrobo",
      "cercis siliquastrum": "Arbre de l'amor / Arbre de Judes",
      "chamaerops humilis": "Margall√≥ / Palmito",
      "cistus monspeliensis": "Estepa negra / Jaguarzo negro",
      "citrus aurantium": "Taronger agre / Naranjo amargo",
      // 2nd deck:
      "convolvulus cneorum":
        "Campanera argentada / Campanilla de hojas plateadas",
      "coronilla glauca": "Coronil¬∑la / Carolina de jard√≠n",
      "cotoneaster pannosus": "Cotoneaster / Gri√±olera afelpada",
      "crataegus monogyna": "Ar√ß blanc / Espino albar",
      "cupressus sempervirens": "Xiprer / Cipr√©s",
      "cyclamen persicum": "Ciclamen",
      "cynodon dactylon": "Gram / Grama com√∫n",
      "cyperus involucratus": "Paraig√ºets / Paraguas",
      "cyrtomium falcatum": "Falguera gr√®vol / Cirtomio",
      "elaeagnus x ebbingei": "Eleagne d'Ebbinge / Eleagno de Ebbinge",
      "erigeron karvinskianus": "Vitad√≠nia / Margarita cimarrona",
      "escallonia rubra": "Escal¬∑l√≤nia / Escalonia",
    };

    // vars
    const savedDeck = localStorage.getItem("selectedDeck");
    let currentDeck = decks[savedDeck] || decks.deck1;
    document.addEventListener("DOMContentLoaded", () => {
      const select = document.getElementById("deck-select");
      if (savedDeck) {
        select.value = savedDeck;
        const listNumber = select.options[select.selectedIndex].text.match(/\d+/)?.[0] || "?";
        document.getElementById("deck-name").textContent = select.value.replace('deck', '');
      }

    });
    let currentSciName = "";
    let currentImage = "";
    let zoomLevel = 1;
    let correct = 0;
    let wrong = 0;
    let cycles = 0;
    let phase = 1;
    let answered = false;
    let attempts = 0;
    let deck = [];
    let remainingImages = {};
    let showingCommon = false;
    let completedPlants = new Set();

    function switchToCommonNames(currentPlant) {
      showingCommon = true;
      const ul = document.getElementById("plant-items");
      ul.innerHTML = "";

      currentDeck = shuffle([...currentDeck]);

      currentDeck.forEach(name => {
        const li = document.createElement("li");
        li.id = "plant-" + name.replace(/\s+/g, "-");
        li.textContent = commonNames[name] || name;

        if (completedPlants.has(name)) {
          li.classList.add("completed");
        }

        li.addEventListener("click", () => {
          if (name === currentPlant) {
            correct++;
            updateScoreboard();

            const remaining = remainingImages[name] || [];
            if (remaining.length <= 1) {
              markPlantCompleted(name);
              deck = deck.filter(n => n !== name);
            } else {
              remaining.pop();
            }

            showingCommon = false;
            renderPlantList();
            nextPlant();
          }
        });

        ul.appendChild(li);
      });
    }


    function renderPlantList() {
      currentDeck = shuffle([...currentDeck]);

      const ul = document.getElementById("plant-items");
      ul.innerHTML = "";

      currentDeck.forEach(name => {
        const li = document.createElement("li");
        li.id = "plant-" + name.replace(/\s+/g, "-");
        li.textContent = name;

        if (completedPlants.has(name)) {
          li.classList.add("completed");
        }

        li.addEventListener("click", () => {
          if (showingCommon) return;

          const sciName = name;
          if (currentSciName === name) {
            correct++;
            updateScoreboard();

            document.getElementById("result").innerHTML =
              `‚úÖ Correct ‚Üí <span class="sci-name">${sciName}</span>`;

            const totalImages = plants[name]?.length || 0;

            switchToCommonNames(name);
          } else {
            wrong++;
            updateScoreboard();
            document.getElementById("result").innerHTML =
              `‚ùå Wrong ‚Üí This image belongs to <span class="sci-name">${currentSciName}</span>`;
          }
        });

        ul.appendChild(li);
      });
    }





    function markPlantCompleted(name) {
      completedPlants.add(name);
      const li = document.getElementById("plant-" + name.replace(/\s+/g, "-"));
      if (li) li.classList.add("completed");
    }


    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function initDeck() {
      deck = shuffle(currentDeck.map((name) => name));
      remainingImages = {};
      currentDeck.forEach((name) => {
        remainingImages[name] = plants[name] ? plants[name].slice() : [];
      });
      currentDeck = shuffle([...currentDeck]);
      renderPlantList();
    }

    function selectDeck() {
      const select = document.getElementById("deck-select");
      const selected = select.value;
      localStorage.setItem("selectedDeck", selected);
      currentDeck = decks[selected] || [];
      document.getElementById("deck-name").textContent =
        `${select.value.replace('deck', '')}`;
      initDeck();
      nextPlant();
    }

    function normalize(text) {
      return text
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .toLowerCase();
    }

    function isApproxMatch(input, target) {
      input = normalize(input);
      target = normalize(target);

      if (input.length < 3) return false;

      for (let i = 0; i < input.length - 2; i++) {
        const segment = input.slice(i, i + 3);
        if (target.includes(segment)) return true;
      }

      let matches = 0;
      for (let char of input) {
        if (target.includes(char)) matches++;
      }
      return matches / target.length >= 0.6;
    }


    function nextPlant() {
      if (showingCommon) {
        showingCommon = false;
        renderPlantList();
      }

      if (deck.length === 0) {
        cycles++;
        updateScoreboard();

        if (currentDeck.length === 0) {
          document.getElementById("summary").textContent = "‚ö†Ô∏è No hi ha plantes v√†lides en aquesta llista!";
          return;
        }

        document.getElementById("summary").textContent = `üéâ Cycle ${cycles} completed!`;
        setTimeout(() => document.getElementById("summary").textContent = "", 2000);
        initDeck();
        return;
      }

      const randomIndex = Math.floor(Math.random() * deck.length);
      currentSciName = deck[randomIndex];
      const imgs = remainingImages[currentSciName];
      if (!imgs || imgs.length === 0) return nextPlant();
      currentImage = imgs[Math.floor(Math.random() * imgs.length)];

      const img = document.getElementById("plant-image");
      img.src = currentImage;
      img.style.transform = "scale(1)";
      zoomLevel = 1;

      document.getElementById("result").textContent = "";
      const guessInput = document.getElementById("guess");
      guessInput.value = "";
      guessInput.disabled = false;
      guessInput.focus();
      answered = false;
      phase = 1;
    }


    function checkOrNext() {
      const guessInput = document.getElementById("guess");
      const guess = normalize(guessInput.value.trim());
      const sciName = normalize(currentSciName);
      const common = normalize(commonNames[currentSciName] || "");

      if (answered || guess === "") {
        attempts++;
        updateScoreboard();
        nextPlant();
        return;
      }

      if (phase === 1) {
        attempts++;
        if (isApproxMatch(guess, sciName)) {
          document.getElementById("result").innerHTML =
            `‚úÖ Correct (phase 1) ‚Üí <span class="sci-name">${currentSciName}</span>`;
          phase = 2;
          guessInput.value = "";

          switchToCommonNames(currentSciName);
          return;
        } else {
          wrong++;
          document.getElementById("result").innerHTML =
            `‚ùå It was: <span class="sci-name">${currentSciName}</span> <span class="common-name">${commonNames[currentSciName] || ""}</span>`;
          answered = true;
        }
        updateScoreboard();
        return;
      }

      if (phase === 2) {
        attempts++;
        if (isApproxMatch(guess, common)) {
          correct++;
          document.getElementById(
            "result"
          ).innerHTML = `‚úÖ Correct (phase 2) ‚Üí <span class="sci-name">${currentSciName}</span> <span class="common-name">${commonNames[currentSciName] || ""
          }</span>`;
          remainingImages[currentSciName] = remainingImages[
            currentSciName
          ].filter((img) => img !== currentImage);
          if (remainingImages[currentSciName].length === 0) {
            deck = deck.filter((name) => name !== currentSciName);
            markPlantCompleted(currentSciName);
          }
          if (deck.length === 0) {
            cycles++;
            updateScoreboard();

            if (currentDeck.length === 0) {
              document.getElementById("summary").textContent = "‚ö†Ô∏è No hi ha plantes v√†lides en aquesta llista!";
              return;
            }

            document.getElementById("summary").textContent = `üéâ Cycle ${cycles} completed!`;
            setTimeout(() => document.getElementById("summary").textContent = "", 2000);
            initDeck();
            return;
          }

        } else {
          wrong++;
          document.getElementById(
            "result"
          ).innerHTML = `‚ùå It was: <span class="sci-name">${currentSciName}</span> <span class="common-name">${commonNames[currentSciName] || ""
          }</span>`;
        }
        answered = true;
        updateScoreboard();
      }
    }

    function updateScoreboard() {
      document.getElementById("correct-count").textContent = correct;
      document.getElementById("wrong-count").textContent = wrong;
      document.getElementById("cycle-count").textContent = cycles;
    }

    const img = document.getElementById("plant-image");
    img.addEventListener("wheel", (event) => {
      event.preventDefault();
      const rect = img.getBoundingClientRect();
      const x = ((event.clientX - rect.left) / rect.width) * 100;
      const y = ((event.clientY - rect.top) / rect.height) * 100;
      img.style.transformOrigin = `${x}% ${y}%`;
      zoomLevel += event.deltaY < 0 ? 0.1 : -0.1;
      zoomLevel = Math.max(0.5, Math.min(3, zoomLevel));
      img.style.transform = `scale(${zoomLevel})`;
    });

    document.addEventListener("keydown", (event) => {
      if (event.key === "Enter") {
        document.getElementById("action-button").click();
        document.getElementById("guess").focus();
      }
    });
    setTimeout(() => {
      const msg = document.getElementById("welcome-message");
      if (msg) msg.remove();
    }, 3000);

    document.querySelector("h1").addEventListener("click", () => {
      location.reload();
    });

    initDeck();
    nextPlant();
  </script>
</body>

</html>