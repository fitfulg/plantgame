<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>Plant Identification Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #121212;
      color: #e0e0e0;
      margin: 0;
      padding: 20px;
    }

    h1 {
      color: #90caf9;
    }

    #plant-container {
      display: inline-block;
      overflow: hidden;
      border: 2px solid #555;
      border-radius: 10px;
      background-color: #1e1e1e;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
    }

    #plant-image {
      width: auto;
      max-height: 60vh;
      max-width: 90vw;
      object-fit: contain;
      margin: 10px auto;
      display: block;
      transition: transform 0.2s ease;
    }


    #input-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      margin: 10px auto;
      flex-wrap: nowrap;
      width: 100%;
      max-width: 400px;
    }

    #input-container input {
      flex: 1;
      min-width: 0;
      padding: 8px;
      font-size: 16px;
      border: 2px solid #555;
      border-radius: 5px;
      background-color: #1e1e1e;
      color: #e0e0e0;
    }

    #input-container button {
      padding: 8px 14px;
      font-size: 15px;
      border: none;
      border-radius: 5px;
      background-color: #1976d2;
      color: white;
      cursor: pointer;
      white-space: nowrap;
    }

    #input-container button:hover {
      background-color: #1565c0;
    }

    @media (max-width: 480px) {
      #input-container {
        flex-direction: row;
        width: 95%;
        max-width: 340px;
      }

      #input-container input {
        font-size: 14px;
        padding: 6px;
      }

      #input-container button {
        font-size: 14px;
        padding: 6px 10px;
      }
    }

    button:hover {
      background-color: #1565c0;
    }

    #deck-select {
      font-size: 18px;
      padding: 5px 10px;
      border-radius: 5px;
      background-color: #1e1e1e;
      color: #e0e0e0;
      border: 2px solid #555;
      margin-top: 10px;
    }

    #result {
      font-size: 22px;
      font-weight: bold;
      margin-top: 15px;
    }

    .sci-name {
      color: #ffffff;
      font-weight: bold;
    }

    .common-name {
      color: #81c784;
      font-style: italic;
      margin-left: 10px;
    }

    #scoreboard {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin: 15px 0;
      font-size: 15px;
    }

    #scoreboard .stat {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 6px;
      font-weight: 600;
      background-color: #1e1e1e;
    }

    .correct {
      color: #4caf50;
      border: 1px solid #4caf50;
    }

    .wrong {
      color: #f44336;
      border: 1px solid #f44336;
    }

    .cycles {
      color: #8bc34a;
      border: none;
      /* üü¢ Elimina el contorn */
      background-color: transparent;
    }

    .deck {
      color: #ffb300;
      border: none;
      background-color: transparent;
    }


    @media (max-width: 480px) {
      #scoreboard {
        font-size: 13px;
        gap: 6px;
      }

      #scoreboard .stat {
        padding: 3px 6px;
      }
    }



    #summary {
      font-size: 20px;
      font-weight: bold;
      margin-top: 20px;
      color: #ffeb3b;
    }

    #plant-list {
      position: fixed;
      right: 10px;
      top: 80px;
      width: 250px;
      max-height: 80vh;
      overflow-y: auto;
      background-color: #1e1e1e;
      border: 2px solid #555;
      border-radius: 8px;
      padding: 10px;
      font-size: 14px;
      text-align: left;
    }

    #plant-list h2 {
      color: #90caf9;
      font-size: 16px;
      margin-top: 0;
    }

    #plant-list ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    #plant-list li {
      margin: 6px 0;
      font-size: 18px;
      line-height: 1.5;
    }

    #plant-list li {
      margin: 8px 0;
      font-size: 18px;
      line-height: 1.5;
      text-align: left;
    }

    #plant-list li.completed {
      text-decoration: line-through;
      color: #888;
    }


    @media (max-width: 768px) {
      #plant-list {
        position: static;
        width: 100%;
        max-height: none;
        margin-top: 10px;
      }

      #plant-list ul {
        display: block;
        padding: 0 10px;
      }

      #plant-list li {
        display: block;
        text-align: center;
        font-size: 17px;
        margin: 10px 0;
      }
    }


    #welcome-message {
      position: fixed;
      top: 45%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: #ffeb3b;
      font-size: 22px;
      font-weight: bold;
      padding: 14px 22px;
      border-radius: 10px;
      text-align: center;
      z-index: 9999;
      opacity: 0;
      animation: fadeInOut 2.5s ease-in-out forwards;
      line-height: 1.4;
      box-shadow: 0 0 10px rgba(255, 235, 59, 0.4);
    }

    @media (max-width: 480px) {
      #welcome-message {
        font-size: 18px;
        padding: 12px 18px;
        width: 80%;
        line-height: 1.3;
      }
    }

    @keyframes fadeInOut {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.9);
      }

      10% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }

      90% {
        opacity: 1;
      }

      100% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.95);
      }
    }

    h1:hover,
    #plant-list li:hover {
      cursor: pointer;
    }

    #version-tag {
      position: fixed;
      bottom: 6px;
      right: 10px;
      font-size: 12px;
      color: #90caf9;
      opacity: 0.8;
      font-family: monospace;
      background-color: rgba(0, 0, 0, 0.6);
      padding: 3px 6px;
      border-radius: 5px;
      z-index: 999;
    }

    @media (max-width: 480px) {
      #version-tag {
        font-size: 11px;
        bottom: 4px;
        right: 6px;
        opacity: 0.9;
      }
    }
  </style>
</head>

<body>
  <div id="welcome-message">‚ú® Escriu o selecciona la planta ‚ú®</div>

  <h1>üå± Plant game</h1>

  <div id="top-bar" style="
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 14px;
  margin-bottom: 8px;
  flex-wrap: wrap;
">
    <select id="deck-select" onchange="selectDeck()" style="
    font-size: 15px;
    padding: 4px 8px;
    border-radius: 6px;
    background: #222;
    color: #fff;
    border: 1px solid #555;
  ">
      <option value="deck1">Llistat 1</option>
      <option value="deck2">Llistat 2</option>
      <option value="deck3">Llistat 3</option>
      <option value="deck4">Llistat 4</option>
      <option value="deck5">Llistat 5</option>
      <option value="deck6">Llistat 6</option>
      <option value="deck7">Llistat 7</option>
    </select>

    <div id="timer" style="
    font-size: 20px;
    color: #ffd54f;
    line-height: 1;
    margin-top: 2px;
  ">
      ‚è±Ô∏è 0s
    </div>
  </div>



  <div id="scoreboard"
    style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;justify-content:center;margin-bottom:8px;">
    <div class="stat correct">‚úÖ <span id="correct-count">0</span></div>
    <div class="stat wrong">‚ùå <span id="wrong-count">0</span></div>

    <!-- Hidden stats for future use -->
    <div class="stat cycles" style="display:none;">‚ôªÔ∏è <span id="cycle-count">0</span></div>
    <div class="stat deck" style="display:none;">üÉè: <span id="deck-name">1</span></div>

    <button id="toggle-best-btn" style="
  display:flex;
  align-items:center;
  gap:6px;
  background:#222;
  border:2px solid #555;
  border-radius:8px;
  color:#ffca28;
  padding:4px 10px;
  cursor:pointer;
  font-size:14px;
  transition:all 0.2s ease-in-out;
">
      üèÜ <span>Millors temps ‚ñº</span>
      <button id="skip-hide-btn" title="Prem + per a avan√ßar 5 segons" style="
  background:#444;
  color:#ffb300;
  border:none;
  border-radius:6px;
  padding:4px 10px;
  cursor:pointer;
  font-size:14px;
  margin-left:5px;
  transition:all 0.2s ease;
">
        ‚è© +5‚Ä≥
      </button>

    </button>


  </div>

  <div id="timer" style="font-size:16px;color:#ffd54f;text-align:center;margin-bottom:4px;"></div>

  <div id="best-times" style="margin-top:4px;font-size:14px;color:#80cbc4;display:none;text-align:center;">
  </div>


  <div id="plant-container">
    <img id="plant-image" src="" alt="plant" />
  </div>
  <br />
  <div id="input-container">
    <input type="text" id="guess" placeholder="Escriu el nom..." />
    <button id="action-button" onclick="checkOrNext()">Continua</button>
  </div>

  <p id="result"></p>
  <p id="summary"></p>

  <div id="plant-list">
    <h2>üëá Selecciona la planta:</h2>
    <ul id="plant-items"></ul>
  </div>

  <script>

    const decks = {
      deck1: [
        "abeliaxgrandiflora",
        "acanthus mollis",
        "acca sellowiana",
        "acer monspessulanum",
        "agapanthus africanus",
        "albizia julibrissin",
        "arbutus unedo",
        "asparagus densiflorus",
        "aucuba japonica",
        "bergenia crassifolia",
        "bougainvillea glabra",
        "brachychiton populneus",
        "buxus sempervirens",
        "calendula officinalis",
        "callistemon citrinus",
        "catalpa bignonioides",
        "cedrus deodara",
        "celtis australis",
        "ceratonia siliqua",
        "cercis siliquastrum",
        "chamaerops humilis",
        "cistus monspeliensis",
        "citrus aurantium",
      ],
      deck2: [
        "convolvulus cneorum",
        "coronilla glauca",
        "cotoneaster pannosus",
        "crataegus monogyna",
        "cupressus sempervirens",
        "cyclamen persicum",
        "cynodon dactylon",
        "cyperus involucratus",
        "cyrtomium falcatum",
        "elaeagnus x ebbingei",
        "erigeron karvinskianus",
        "escallonia rubra",
        "eucalyptus camaldulensis",
        "euonymus japonicus",
      ],
      deck3: [
        "fatsia japonica",
        "ficus carica",
        "firmiana simplex",
        "gazania sp",
        "ginkgo biloba",
        "gleditsia triacanthos",
        "grevillea robusta",
        "hedera helix",
        "hibiscus rosa-sinensis",
        "hibiscus syriacus",
        "iris germanica",
        "jacaranda mimosifolia",
        "jasminum officinale",
        "lagerstroemia indica"
      ],
      deck4: [
        "lantana camara",
        "laurus nobilis",
        "lavandula angustifolia",
        "lavandula dentata",
        "ligustrum lucidum",
        "lobularia maritima",
        "magnolia grandiflora",
        "medicago arborea",
        "melia azedarach",
        "myoporum tenuifolium",
        "myrtus communis",
        "nephrolepis cordifolia",
        "nerium oleander",
        "olea europaea"
      ],
      deck5: [
        "osteospermum ecklonis",
        "parkinsonia aculeata",
        "parthenocissus tricuspidata",
        "passiflora caerulea",
        "phormium tenax",
        "phytolacca dioica",
        "pistacia lentiscus",
        "pittosporum tobira",
        "plumbago auriculata",
        "polygala myrtifolia",
        "populus alba",
        "prunus cerasifera var. pissardii",
        "prunus dulcis",
        "prunus laurocerasus"
      ],
      deck6: [
        "punica granatum",
        "pyracantha coccinea",
        "quercus ilex",
        "rhaphiolepis umbellata",
        "robinia pseudoacacia",
        "rosmarinus officinalis",
        "ruscus aculeatus",
        "salix babylonica",
        "salvia officinalis",
        "santolina chamaecyparissus",
        "schinus molle",
        "spartium junceum",
        "spiraea cantoniensis",
        "styphnolobium japonicum"
      ],
      deck7: [
        "tagetes patula",
        "tamarix gallica",
        "taxus baccata",
        "tecoma capensis",
        "teucrium fruticans",
        "thymus vulgaris",
        "tilia tomentosa",
        "tipuana tipu",
        "typha angustifolia",
        "viburnum tinus",
        "vinca major",
        "viola cornuta",
        "wisteria sinensis",
        "zantedeschia aethiopica"
      ],
    };

    const plants = {
      "abeliaxgrandiflora": ["AbeliaXgrandiflora.png", "abelia2.png"],
      "acanthus mollis": ["Acanthus_mollis.png", "acant2.png"],
      "acca sellowiana": [
        "Acca_sellowiana.png",
        "feijoa-acca-sellowiana-semillas.png",
        "feijoa.png",
      ],
      "acer monspessulanum": ["Acer_monspessulanum.png", "acer2.png"],
      "agapanthus africanus": ["Agapanthus africanus.png"],
      "albizia julibrissin": ["Albizia julibrissin.png", "albizia2.png"],
      "arbutus unedo": ["arbutus unedo.png", "arbutusunedo2.png"],
      "asparagus densiflorus": [
        "Asparagus densiflorus.png",
        "asparagus2.png",
      ],
      "aucuba japonica": ["Aucuba japonica.png"],
      "bergenia crassifolia": ["Bergenia crassifolia.png", "Bergenia2.png"],
      "bougainvillea glabra": [
        "Bougainvillea glabra.png",
        "bougainvillea2.png",
      ],
      "brachychiton populneus": [
        "Brachychiton populneus.png",
        "Brachychiton2.png",
        "Brachychiton3.png",
      ],
      "buxus sempervirens": [
        "Buxus sempervirens.png",
        "buxus2.png",
        "buxus3.png",
      ],
      "calendula officinalis": [
        "Calendula officinalis.png",
        "Calendula2.png",
      ],
      "callistemon citrinus": [
        "Callistemon citrinus.png",
        "Callistemon2.png",
      ],
      "catalpa bignonioides": [
        "Catalpa bignonioides.png",
        "Catalpa2.png",
        "Catalpa3.png",
      ],
      "cedrus deodara": ["Cedrus deodara.png", "Cedrus2.png"],
      "celtis australis": ["Celtis australis.png", "Celtis2.png"],
      "ceratonia siliqua": ["Ceratonia siliqua.png", "Ceratonia2.png"],
      "cercis siliquastrum": [
        "Cercis siliquastrum.png",
        "Cercis2.png",
        "Cercis3.png",
      ],
      "chamaerops humilis": ["Chamaerops humilis.png"],
      "cistus monspeliensis": ["Cistus monspeliensis.png", "Cistus2.png"],
      "citrus aurantium": ["Citrus aurantium.png", "Citrus2.png"],
      // 2nd deck:
      "convolvulus cneorum": ["Convolvulus cneorum.png", "Convolvulus2.png"],
      "coronilla glauca": ["Coronilla glauca.png", "Coronilla2.png"],
      "cotoneaster pannosus": [
        "Cotoneaster pannosus.png",
        "Cotoneaster2.png",
      ],
      "crataegus monogyna": ["Crataegus monogyna.png", "Crataegus2.png"],
      "cupressus sempervirens": ["Cupressus sempervirens.png"],
      "cyclamen persicum": ["Cyclamen persicum.png"],
      "cynodon dactylon": ["Cynodon dactylon.png"],
      "cyperus involucratus": ["Cyperus involucratus.png"],
      "cyrtomium falcatum": ["Cyrtomium falcatum.png", "Cyrtomium2.png"],
      "elaeagnus x ebbingei": ["Elaeagnus x ebbingei.png"],
      "erigeron karvinskianus": ["Erigeron karvinskianus.png"],
      "escallonia rubra": ["Escallonia rubra.png", "Escallonia2.png"],
      "eucalyptus camaldulensis": ["Eucalyptus camaldulensis.png", "Eucalyptus2.png"],
      "euonymus japonicus": ["Euonymus japonicus.png", "Euonymus2.png"],
      // 3rd deck:
      "fatsia japonica": ["Fatsia japonica.png", "Fatsia2.png"],
      "ficus carica": ["Ficus carica.png", "Ficus2.png"],
      "firmiana simplex": ["Firmiana simplex.png", "Firmiana2.png"],
      "gazania sp": ["Gazania sp.png"],
      "ginkgo biloba": ["Ginkgo biloba.png", "Ginkgo2.png"],
      "gleditsia triacanthos": ["Gleditsia triacanthos.png", "Gleditsia2.png"],
      "grevillea robusta": ["Grevillea robusta.png", "Grevillea2.png"],
      "hedera helix": ["Hedera helix.png"],
      "hibiscus rosa-sinensis": ["Hibiscus rosa-sinensis.png", "Hibiscus2.png"],
      "hibiscus syriacus": ["Hibiscus syriacus.png", "Hibiscus syriacus2.png"],
      "iris germanica": ["Iris germanica.png", "Iris2.png"],
      "jacaranda mimosifolia": ["Jacaranda mimosifolia.png", "Jacaranda2.png"],
      "jasminum officinale": ["Jasminum officinale.png", "Jasminum2.png"],
      "lagerstroemia indica": ["Lagerstroemia indica.png", "Lagerstroemia2.png"],
      // 4th deck:
      "lantana camara": ["Lantana camara.png"],
      "laurus nobilis": ["Laurus nobilis.png"],
      "lavandula angustifolia": ["Lavandula angustifolia.png", "Lavandula2.png"],
      "lavandula dentata": ["Lavandula dentata.png", "Lavandula dentata2.png"],
      "ligustrum lucidum": ["Ligustrum lucidum.png", "Ligustrum2.png"],
      "lobularia maritima": ["Lobularia maritima.png", "Lobularia2.png"],
      "magnolia grandiflora": ["Magnolia grandiflora.png"],
      "medicago arborea": ["Medicago arborea.png", "Medicago2.png"],
      "melia azedarach": ["Melia azedarach.png", "Melia2.png"],
      "myoporum tenuifolium": ["Myoporum tenuifolium.png", "Myoporum2.png"],
      "myrtus communis": ["Myrtus communis.png", "Myrtus2.png", "Myrtus3.png"],
      "nephrolepis cordifolia": ["Nephrolepis cordifolia.png", "Nephrolepis2.png"],
      "nerium oleander": ["Nerium oleander.png"],
      "olea europaea": ["Olea europaea.png", "Olea2.png"],
      // 5th deck:
      "osteospermum ecklonis": ["Osteospermum ecklonis.png"],
      "parkinsonia aculeata": ["Parkinsonia aculeata.png", "Parkinsonia2.png"],
      "parthenocissus tricuspidata": ["Parthenocissus tricuspidata.png", "Parthenocissus2.png"],
      "passiflora caerulea": ["Passiflora caerulea.png", "Passiflora2.png"],
      "phormium tenax": ["Phormium tenax.png"],
      "phytolacca dioica": ["Phytolacca dioica.png", "Phytolacca2.png"],
      "pistacia lentiscus": ["Pistacia lentiscus.png"],
      "pittosporum tobira": ["Pittosporum tobira.png"],
      "plumbago auriculata": ["Plumbago auriculata.png", "Plumbago2.png"],
      "polygala myrtifolia": ["Polygala myrtifolia.png", "Polygala2.png"],
      "populus alba": ["Populus alba.png"],
      "prunus cerasifera var. pissardii": ["Prunus cerasifera var. pissardii.png", "Prunus2.png"],
      "prunus dulcis": ["Prunus dulcis.png"],
      "prunus laurocerasus": ["Prunus laurocerasus.png", "Prunuslauro2.png"],
      // 6th deck:
      "punica granatum": ["Punica granatum.png", "Punica2.png"],
      "pyracantha coccinea": ["Pyracantha coccinea.png", "Pyracantha2.png"],
      "quercus ilex": ["Quercus ilex.png"],
      "rhaphiolepis umbellata": ["Rhaphiolepis umbellata.png", "Rhaphiolepis2.png"],
      "robinia pseudoacacia": ["Robinia pseudoacacia.png"],
      "rosmarinus officinalis": ["Rosmarinus officinalis.png"],
      "ruscus aculeatus": ["Ruscus aculeatus.png", "Ruscus2.png"],
      "salix babylonica": ["Salix babylonica.png", "Salix2.png"],
      "salvia officinalis": ["Salvia officinalis.png", "Salvia2.png"],
      "santolina chamaecyparissus": ["Santolina chamaecyparissus.png", "Santolina2.png"],
      "schinus molle": ["Schinus molle.png", "Schinus2.png"],
      "spartium junceum": ["Spartium junceum.png", "Spartium2.png"],
      "spiraea cantoniensis": ["Spiraea cantoniensis.png", "Spiraea2.png"],
      "styphnolobium japonicum": ["Styphnolobium japonicum.png"],
      // 7th deck:
      "tagetes patula": ["Tagetes patula.png", "Tagetes2.png"],
      "tamarix gallica": ["Tamarix gallica.png", "Tamarix2.png"],
      "taxus baccata": ["Taxus baccata.png", "Taxus2.png"],
      "tecoma capensis": ["Tecoma capensis.png", "Tecoma2.png"],
      "teucrium fruticans": ["Teucrium fruticans.png", "Teucrium2.png"],
      "thymus vulgaris": ["Thymus vulgaris.png", "Thymus2.png"],
      "tilia tomentosa": ["Tilia tomentosa.png", "Tilia2.png"],
      "tipuana tipu": ["Tipuana tipu.png", "Tipuana2.png"],
      "typha angustifolia": ["Typha angustifolia.png"],
      "viburnum tinus": ["Viburnum tinus.png", "Viburnum2.png"],
      "vinca major": ["Vinca major.png", "Vinca2.png"],
      "viola cornuta": ["Viola cornuta.png", "Viola2.png"],
      "wisteria sinensis": ["Wisteria sinensis.png", "Wisteria2.png"],
      "zantedeschia aethiopica": ["Zantedeschia aethiopica.png"],
    };

    // Noms comuns en catal√†/castell√†
    const commonNames = {
      "abeliaxgrandiflora": "Ab√®lia",
      "acanthus mollis": "Acant de fulla ampla",
      "acca sellowiana": "Feijoa",
      "acer monspessulanum": "Aur√≥ negre",
      "agapanthus africanus": "Agapant",
      "albizia julibrissin": "Ac√†cia de Constantinoble / √Årbol de la seda",
      "arbutus unedo": "Cireretes de pastor / Madro√±o",
      "asparagus densiflorus": "Esparraguera de jard√≠",
      "aucuba japonica": "Llorer tacat",
      "bergenia crassifolia": "Berg√®nia / Hortensia de invierno",
      "bougainvillea glabra": "Buguenv√≠l¬∑lea / Buganvilla com√∫n",
      "brachychiton populneus": "Arbre ampolla / √Årbol botella",
      "buxus sempervirens": "Boix com√∫ / Boj",
      "calendula officinalis": "Cal√®ndula / Boixac Anual / Flamenquilla",
      "callistemon citrinus": "Escura-xemeneies / Limpiatubos",
      "catalpa bignonioides": "Catalpa",
      "cedrus deodara": "Cedre de l'Him√†laia",
      "celtis australis": "Lledoner / Almer",
      "ceratonia siliqua": "Garrofer / Algarrobo",
      "cercis siliquastrum": "Arbre de l'amor / Arbre de Judes",
      "chamaerops humilis": "Margall√≥ / Palmito",
      "cistus monspeliensis": "Estepa negra / Jaguarzo negro",
      "citrus aurantium": "Taronger agre / Naranjo amargo",
      // 2nd deck:
      "convolvulus cneorum":
        "Campanera argentada / Campanilla de hojas plateadas",
      "coronilla glauca": "Coronil¬∑la / Carolina de jard√≠n",
      "cotoneaster pannosus": "Cotoneaster / Gri√±olera afelpada",
      "crataegus monogyna": "Ar√ß blanc / Espino albar",
      "cupressus sempervirens": "Xiprer / Cipr√©s",
      "cyclamen persicum": "Ciclamen",
      "cynodon dactylon": "Gram / Grama com√∫n",
      "cyperus involucratus": "Paraig√ºets / Paraguas",
      "cyrtomium falcatum": "Falguera gr√®vol / Cirtomio",
      "elaeagnus x ebbingei": "Eleagne d'Ebbinge / Eleagno de Ebbinge",
      "erigeron karvinskianus": "Vitad√≠nia / Margarita cimarrona",
      "escallonia rubra": "Escal¬∑l√≤nia / Escalonia",
      "eucalyptus camaldulensis": "Eucaliptus de fulla estreta / Gomero rojo",
      "euonymus japonicus": "Ev√≤nim del Jap√≥ / Bonetero del Jap√≥n",
      // 3rd deck:
      "fatsia japonica": "Ar√†lia del Jap√≥ / Aralia del Jap√≥n",
      "ficus carica": "Figuera / Higuera",
      "firmiana simplex": "Firmiana / Parasol de la China",
      "gazania sp": "Gaz√†nia / Gazania",
      "ginkgo biloba": "Ginkgo / √Årbol de los cuarenta escudos",
      "gleditsia triacanthos": "Ac√†cia de les tres punxes / Acacia de tres espinas",
      "grevillea robusta": "Grev√≠lea / Grevillea",
      "hedera helix": "Heura / Hiedra",
      "hibiscus rosa-sinensis": "Hibisc de la Xina/Rosa de China",
      "hibiscus syriacus": "Hibisc de S√≠ria / Altea de Siria",
      "iris germanica": "Lliri blau / Lirio c√°rdeno",
      "jacaranda mimosifolia": "Xicranda / Jacaranda",
      "jasminum officinale": "Gessam√≠ / Jazm√≠n",
      "lagerstroemia indica": "Arbre de J√∫piter / √Årbol de J√∫piter",
      // 4th deck:
      "lantana camara": "Lantana / Bandera espa√±ola",
      "laurus nobilis": "Llorer / Laurel",
      "lavandula angustifolia": "Esp√≠gol / Espliego",
      "lavandula dentata": "Esp√≠gol retallat / Alhucema rizada",
      "ligustrum lucidum": "Troana / Aligustre del Jap√≥n",
      "lobularia maritima": "Caps blancs / Aliso de mar",
      "magnolia grandiflora": "Magn√≤lia / Magnolio com√∫n",
      "medicago arborea": "Alfals arbori / Alfalfa arborea",
      "melia azedarach": "M√®lia / Cinamomo",
      "myoporum tenuifolium": "Mi√≤por / Mi√≥poro com√∫n",
      "myrtus communis": "Murtra / Array√°n",
      "nephrolepis cordifolia": "Espina de llu√ß / Helecho serrucho",
      "nerium oleander": "Baladre / Adelfa",
      "olea europaea": "Olivera / Olivo",
      // 5th deck:
      "osteospermum ecklonis": "Margarida de bot√≥ blau / argarita del Cabo",
      "parkinsonia aculeata": "Parquins√≤nia / Palo verde o Espinillo",
      "parthenocissus tricuspidata": "Heura del Jap√≥ o Parra verge / Parra virgen",
      "passiflora caerulea": "Passionera / Flor Pasionaria",
      "phormium tenax": "Formi / Lino de Nueva Zelanda",
      "phytolacca dioica": "Bellaombra / √Årbol de la bella sombra",
      "pistacia lentiscus": "Llentiscle / Lentisco",
      "pittosporum tobira": "Pitospor / Azahar de la China",
      "plumbago auriculata": "Llessam√≠ blau / Jazm√≠n azul o Celestinas",
      "polygala myrtifolia": "Pol√≠gala de fulla de murta / Pol√≠gala",
      "populus alba": "√Älber / √Ålamo blanco",
      "prunus cerasifera var. pissardii": "Prunera de fulla vermella / Ciruelo rojo",
      "prunus dulcis": "Ametller / Almendro",
      // 6th deck:
      "punica granatum": "Magraner / Granado",
      "pyracantha coccinea": "Piracanta o Pometes del diable / Espino de fuego",
      "quercus ilex": "Alzina / Encina",
      "rhaphiolepis umbellata": "Raf√≠olepis del Jap√≥ / Rafiolepis del Jap√≥n",
      "robinia pseudoacacia": "Rob√≠nia / Falsa acacia",
      "rosmarinus officinalis": "Roman√≠ / Romero",
      "ruscus aculeatus": "Galzeran / Brusco com√∫n o Rusco",
      "salix babylonica": "Desmai / Sauce llor√≥n",
      "salvia officinalis": "S√†lvia / Salvia",
      "santolina chamaecyparissus": "Espernallac / Abr√≥tano hembra",
      "schinus molle": "Fals pebre / Pimentero",
      "spartium junceum": "Ginesta o Ginestera / Retama de olor",
      "spiraea cantoniensis": "Ram de n√∫via / Corona de novia",
      "styphnolobium japonicum": "Ac√†cia del Jap√≥ / S√≥fora",
      // 7th deck:
      "tagetes patula": "Clavell moro / Clavel moro",
      "tamarix gallica": "Tamariu / Tamarindo o Taray",
      "taxus baccata": "Teix / Tejo",
      "tecoma capensis": "Tecom√†ria / Tecoma",
      "teucrium fruticans": "Teucri blau / Olivilla o Teucrio",
      "thymus vulgaris": "Farigola / Tomillo",
      "tilia tomentosa": "Til¬∑ler argentat / Tilo plateado",
      "tipuana tipu": "Tipuana / Palo rosa",
      "typha angustifolia": "Boga de fulla estreta / Espada√±a de hojas estrechas",
      "viburnum tinus": "Marfull / Durillo",
      "vinca major": "Vinca",
      "viola cornuta": "Pensament/Pensamiento",
      "wisteria sinensis": "Glic√≠nia / Wisteria",
      "zantedeschia aethiopica": "Cal¬∑la o Lliri d'aigua/Cala / Lirio de agua"
    };

    // vars
    const savedDeck = localStorage.getItem("selectedDeck");
    let currentDeck = decks[savedDeck] || decks.deck1;
    document.addEventListener("DOMContentLoaded", () => {
      const select = document.getElementById("deck-select");
      if (savedDeck) {
        select.value = savedDeck;
        const listNumber = select.options[select.selectedIndex].text.match(/\d+/)?.[0] || "?";
        document.getElementById("deck-name").textContent = select.value.replace('deck', '');
      }

    });
    let currentSciName = "";
    let currentImage = "";
    let zoomLevel = 1;
    let correct = 0;
    let wrong = 0;
    let cycles = 0;
    let phase = 1;
    let answered = false;
    let attempts = 0;
    let deck = [];
    let remainingImages = {};
    let showingCommon = false;
    let completedPlants = new Set();
    let startTime = null;
    let timerInterval = null;
    let bestTimes = JSON.parse(localStorage.getItem("bestTimes") || "{}");


    function renderList(isCommon = false, currentPlant = null) {
      const ul = document.getElementById("plant-items");
      ul.innerHTML = "";

      currentDeck.forEach(name => {
        const li = document.createElement("li");
        li.id = "plant-" + name.replace(/\s+/g, "-");
        li.textContent = isCommon ? (commonNames[name] || name) : name;

        if (completedPlants.has(name)) {
          li.classList.add("completed");
        }

        li.addEventListener("click", () => {
          if (isCommon) {
            if (name === currentPlant) {
              correct++;
              updateScoreboard();

              const remaining = remainingImages[name] || [];
              if (remaining.length <= 1) {
                markPlantCompleted(name);
                deck = deck.filter(n => n !== name);
              } else {
                remaining.pop();
              }

              showingCommon = false;
              renderList(false);
              nextPlant();
            }
          } else {
            if (showingCommon) return;

            const sciName = name;
            if (currentSciName === name) {
              correct++;
              updateScoreboard();
              document.getElementById("result").innerHTML =
                `‚úÖ Correcte ‚Üí <span class="sci-name">${sciName}</span>`;
              phase = 2;
              answered = false;
              setTimeout(() => renderList(true, name), 200);
            } else {
              wrong++;
              updateScoreboard();
              document.getElementById("result").innerHTML =
                `‚ùå Incorrecte ‚Üí Aquesta imatge pertany a <span class="sci-name">${currentSciName}</span>`;
            }
          }
        });

        ul.appendChild(li);
      });
    }


    function switchToCommonNames(currentPlant) {
      showingCommon = true;
      renderList(true, currentPlant);
    }


    function renderPlantList() {
      renderList(false);
    }

    function markPlantCompleted(name) {
      completedPlants.add(name);
      const li = document.getElementById("plant-" + name.replace(/\s+/g, "-"));
      if (li) li.classList.add("completed");
    }


    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // // TEST MODE:
    // function forceCycleCompletion() {
    //   currentDeck.forEach(name => completedPlants.add(name));
    //   deck = [];
    //   cycles++;
    //   updateScoreboard();
    //   showCycleCompletionMessage();
    //   console.log("üß™ Test: cicle for√ßat manualment.");
    // }

    // // Optional: listen for "T" key to force cycle completion
    // document.addEventListener("keydown", (e) => {
    //   const target = e.target.tagName.toLowerCase();
    //   if (target === "input" || target === "textarea") return;

    //   if (e.key.toLowerCase() === "t") {
    //     forceCycleCompletion();
    //   }
    // });

    function startTimer() {
      if (timerInterval) clearInterval(timerInterval);
      startTime = Date.now();
      const timerDisplay = document.getElementById("timer");

      timerInterval = setInterval(() => {
        const elapsedSeconds = (Date.now() - startTime) / 1000;
        timerDisplay.textContent = `‚è±Ô∏è ${formatElapsedTime(elapsedSeconds)}`;
      }, 1000);
    }



    function stopTimer() {
      if (!timerInterval) return 0;
      clearInterval(timerInterval);
      timerInterval = null;
      const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
      startTime = null;
      return parseFloat(elapsed);
    }

    function formatElapsedTime(totalSeconds) {
      totalSeconds = Math.floor(totalSeconds);
      const days = Math.floor(totalSeconds / 86400);
      const hours = Math.floor((totalSeconds % 86400) / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;

      let parts = [];
      if (days > 0) parts.push(`${days}d`);
      if (hours > 0 || days > 0) parts.push(`${hours}h`);
      if (minutes > 0 || hours > 0 || days > 0) parts.push(`${minutes}m`);
      parts.push(`${seconds}s`);
      return parts.join(" ");
    }

    function saveBestTime(elapsed) {
      const deckName = document.getElementById("deck-select").value;
      if (!elapsed || elapsed <= 0) return;

      if (!bestTimes[deckName] || elapsed < bestTimes[deckName]) {
        bestTimes[deckName] = elapsed;
        localStorage.setItem("bestTimes", JSON.stringify(bestTimes));
      }
      renderBestTimes();
    }

    function renderBestTimes() {
      const container = document.getElementById("best-times");
      if (!container) return;
      container.innerHTML = "<h3>üèÜ Millors temps</h3>";

      const ul = document.createElement("ul");
      Object.keys(bestTimes).forEach(deck => {
        const formatted = formatElapsedTime(bestTimes[deck]);
        const li = document.createElement("li");
        li.textContent = `${deck.replace('deck', 'Llistat ')} ‚Üí ${formatted}`;
        ul.appendChild(li);
      });
      container.appendChild(ul);
    }


    function initDeck() {
      deck = shuffle(currentDeck.map((name) => name));
      remainingImages = {};
      currentDeck.forEach((name) => {
        remainingImages[name] = plants[name] ? plants[name].slice() : [];
      });
      currentDeck = shuffle([...currentDeck]);
      renderPlantList();
      renderBestTimes();
    }

    function selectDeck() {
      const select = document.getElementById("deck-select");
      const selected = select.value;
      const newDeck = decks[selected];

      if (!newDeck || newDeck.length === 0) {
        document.getElementById("summary").textContent = "‚ö†Ô∏è Aquesta llista est√† buida!";
        return;
      }

      correct = 0;
      wrong = 0;
      cycles = 0;
      updateScoreboard();

      localStorage.setItem("selectedDeck", selected);
      currentDeck = [...newDeck];
      document.getElementById("deck-name").textContent = selected.replace('deck', '');

      initDeck();
      nextPlant();
      startTimer();
    }

    function normalize(text) {
      return text
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .toLowerCase();
    }

    function isApproxMatch(input, target) {
      input = normalize(input);
      target = normalize(target);

      if (input.length < 3) return false;

      for (let i = 0; i < input.length - 2; i++) {
        const segment = input.slice(i, i + 3);
        if (target.includes(segment)) return true;
      }

      let matches = 0;
      for (let char of input) {
        if (target.includes(char)) matches++;
      }
      return matches / target.length >= 0.6;
    }

    function nextPlant() {
      if (showingCommon) {
        showingCommon = false;
        renderPlantList();
      }

      if (deck.length === 0) {
        const allCompleted = currentDeck.every(name => completedPlants.has(name));

        if (allCompleted) {
          cycles++;
          updateScoreboard();
          setTimeout(() => showCycleCompletionMessage(), 100);
          return;
        } else {
          deck = shuffle(currentDeck.filter(name => !completedPlants.has(name)));
          nextPlant();
          return;
        }
      }

      const randomIndex = Math.floor(Math.random() * deck.length);
      currentSciName = deck[randomIndex];
      const imgs = remainingImages[currentSciName];
      if (!imgs || imgs.length === 0) return nextPlant();
      currentImage = imgs[Math.floor(Math.random() * imgs.length)];

      const img = document.getElementById("plant-image");
      img.src = currentImage;
      img.style.transform = "scale(1)";
      zoomLevel = 1;

      stopProgressiveHide();
      startProgressiveHide();

      document.getElementById("result").textContent = "";
      const guessInput = document.getElementById("guess");
      guessInput.value = "";
      guessInput.disabled = false;
      guessInput.focus();
      answered = false;
      phase = 1;
    }

    function checkOrNext() {
      const guessInput = document.getElementById("guess");
      const guess = normalize(guessInput.value.trim());
      const sciName = normalize(currentSciName);
      const common = normalize(commonNames[currentSciName] || "");

      if (answered || guess === "") {
        attempts++;
        updateScoreboard();

        showingCommon = false;
        renderPlantList();
        document.getElementById("result").textContent = "";

        nextPlant();
        return;
      }

      if (phase === 1) {
        attempts++;
        if (isApproxMatch(guess, sciName)) {
          document.getElementById("result").innerHTML =
            `‚úÖ Correcte (fase 1) ‚Üí <span class="sci-name">${currentSciName}</span>`;
          phase = 2;
          guessInput.value = "";

          switchToCommonNames(currentSciName);
          return;
        } else {
          wrong++;
          document.getElementById("result").innerHTML =
            `‚ùå La correcta era: <span class="sci-name">${currentSciName}</span> <span class="common-name">${commonNames[currentSciName] || ""}</span>`;
          answered = true;
        }
        updateScoreboard();
        return;
      }

      if (phase === 2) {
        attempts++;
        if (isApproxMatch(guess, common)) {
          correct++;
          document.getElementById(
            "result"
          ).innerHTML = `‚úÖ Correcte (fase 2) ‚Üí <span class="sci-name">${currentSciName}</span> <span class="common-name">${commonNames[currentSciName] || ""
          }</span>`;
          remainingImages[currentSciName] = remainingImages[
            currentSciName
          ].filter((img) => img !== currentImage);
          if (remainingImages[currentSciName].length === 0) {
            deck = deck.filter((name) => name !== currentSciName);
            markPlantCompleted(currentSciName);
          }

          if (deck.length === 0) {
            cycles++;
            updateScoreboard();

            showCycleCompletionMessage();
            return;
          }

        } else {
          wrong++;
          document.getElementById(
            "result"
          ).innerHTML = `‚ùå It was: <span class="sci-name">${currentSciName}</span> <span class="common-name">${commonNames[currentSciName] || ""
          }</span>`;
        }
        answered = true;
        updateScoreboard();
      }
    }

    function updateScoreboard() {
      document.getElementById("correct-count").textContent = correct;
      document.getElementById("wrong-count").textContent = wrong;
      document.getElementById("cycle-count").textContent = cycles;
    }

    const img = document.getElementById("plant-image");
    img.addEventListener("wheel", (event) => {
      event.preventDefault();
      const rect = img.getBoundingClientRect();
      const x = ((event.clientX - rect.left) / rect.width) * 100;
      const y = ((event.clientY - rect.top) / rect.height) * 100;
      img.style.transformOrigin = `${x}% ${y}%`;
      zoomLevel += event.deltaY < 0 ? 0.1 : -0.1;
      zoomLevel = Math.max(0.5, Math.min(3, zoomLevel));
      img.style.transform = `scale(${zoomLevel})`;
    });

    let initialDistance = 0;
    let lastZoomLevel = 1;

    img.addEventListener("touchstart", (event) => {
      if (event.touches.length === 2) {
        event.preventDefault();

        const dx = event.touches[0].clientX - event.touches[1].clientX;
        const dy = event.touches[0].clientY - event.touches[1].clientY;
        initialDistance = Math.sqrt(dx * dx + dy * dy);

        const rect = img.getBoundingClientRect();
        const midX = ((event.touches[0].clientX + event.touches[1].clientX) / 2 - rect.left) / rect.width * 100;
        const midY = ((event.touches[0].clientY + event.touches[1].clientY) / 2 - rect.top) / rect.height * 100;

        img.style.transformOrigin = `${midX}% ${midY}%`;
        lastZoomLevel = zoomLevel;
      }
    }, { passive: false });

    img.addEventListener("touchmove", (event) => {
      if (event.touches.length === 2) {
        event.preventDefault();

        const dx = event.touches[0].clientX - event.touches[1].clientX;
        const dy = event.touches[0].clientY - event.touches[1].clientY;
        const newDistance = Math.sqrt(dx * dx + dy * dy);

        const scaleChange = newDistance / initialDistance;
        let newZoom = lastZoomLevel * scaleChange;

        newZoom = Math.max(0.5, Math.min(3, newZoom));

        zoomLevel = newZoom;
        img.style.transform = `scale(${zoomLevel})`;
      }
    }, { passive: false });


    document.addEventListener("keydown", (event) => {
      if (event.key === "Enter") {
        document.getElementById("action-button").click();
        document.getElementById("guess").focus();
      }
    });
    setTimeout(() => {
      const msg = document.getElementById("welcome-message");
      if (msg) msg.remove();
    }, 3000);

    document.querySelector("h1").addEventListener("click", () => {
      location.reload();
    });

    fetch("https://api.github.com/repos/fitfulg/plantgame/commits/main")
      .then(response => response.json())
      .then(data => {
        const hash = data.sha.substring(0, 4).toUpperCase();
        const versionTag = document.getElementById("version-tag");
        if (versionTag) versionTag.textContent = `v${hash}`;
      })
      .catch(() => {
        const versionTag = document.getElementById("version-tag");
        if (versionTag) versionTag.textContent = "v----";
      });

    let hideInterval = null;

    function startProgressiveHide() {
      clearInterval(hideInterval);

      const allPlants = Array.from(document.querySelectorAll("#plant-items li"));
      const total = allPlants.length;
      if (total <= 1) return;

      const correctId = "plant-" + currentSciName.replace(/\s+/g, "-");
      let visible = allPlants.map(li => li.id);
      let step = 0;

      hideInterval = setInterval(() => {
        const remaining = visible.filter(id => id !== correctId);
        if (remaining.length === 0) {
          clearInterval(hideInterval);
          return;
        }

        const toHide = Math.min(3, remaining.length - 1);

        const selected = shuffle([...remaining]).slice(0, toHide);
        selected.forEach(id => {
          const el = document.getElementById(id);
          if (el) el.style.display = "none";
        });

        visible = visible.filter(id => !selected.includes(id));

        if (visible.length === 1 && visible[0] === correctId) {
          clearInterval(hideInterval);
        }

      }, 5000);
    }

    function skipHideStep() {
      const allPlants = Array.from(document.querySelectorAll("#plant-items li"))
        .filter(li => li.style.display !== "none");
      if (allPlants.length <= 1) return;

      const correctId = "plant-" + currentSciName.replace(/\s+/g, "-");
      const remaining = allPlants.filter(li => li.id !== correctId);

      if (remaining.length === 0) return;

      const toHide = Math.min(3, remaining.length - 1);
      const selected = shuffle([...remaining]).slice(0, toHide);
      selected.forEach(li => li.style.display = "none");

      if (startTime) {
        startTime -= 5000;
      }
    }



    function stopProgressiveHide() {
      clearInterval(hideInterval);
      const allPlants = document.querySelectorAll("#plant-items li");
      allPlants.forEach(li => li.style.display = "");
    }

    initDeck();
    nextPlant();
    renderBestTimes();
    startTimer();

    document.addEventListener("DOMContentLoaded", () => {
      const skipBtn = document.getElementById("skip-hide-btn");
      if (skipBtn && typeof skipHideStep === "function") {
        skipBtn.addEventListener("click", skipHideStep);
      }

      const toggleBtn = document.getElementById("toggle-best-btn");
      const bestTimesDiv = document.getElementById("best-times");

      if (toggleBtn && bestTimesDiv) {
        toggleBtn.addEventListener("click", () => {
          const isVisible = bestTimesDiv.style.display === "block";
          bestTimesDiv.style.display = isVisible ? "none" : "block";
          toggleBtn.querySelector("span").textContent = isVisible
            ? "Millors temps ‚ñº"
            : "Amagar millors temps ‚ñ≤";
        });
      }
    });


    function showCycleCompletionMessage() {
      const elapsed = stopTimer();
      saveBestTime(elapsed);
      if (document.querySelector("#restart-deck-btn") || document.querySelector("#next-deck-btn")) return;
      const formattedElapsed = formatElapsedTime(elapsed);

      stopProgressiveHide();

      const summary = document.getElementById("summary");
      const currentSelect = document.getElementById("deck-select");
      const nextIndex = currentSelect.selectedIndex + 1;

      summary.style.position = "fixed";
      summary.style.bottom = "10%";
      summary.style.left = "50%";
      summary.style.transform = "translateX(-50%)";
      summary.style.background = "rgba(0,0,0,0.9)";
      summary.style.color = "#fff";
      summary.style.padding = "16px 18px";
      summary.style.borderRadius = "12px";
      summary.style.zIndex = "9999";
      summary.style.textAlign = "center";
      summary.style.boxShadow = "0 0 12px rgba(255,255,255,0.25)";
      summary.style.maxWidth = "90%";
      summary.style.fontSize = "16px";
      summary.style.lineHeight = "1.4";
      summary.style.animation = "fadeIn 0.4s ease-in-out";

      summary.innerHTML = `
üéâ <b>Has completat el llistat!</b><br>
<small>‚è±Ô∏è Temps: <b>${formattedElapsed}</b></small><br><br>
Vols passar al seg√ºent o reiniciar aquest?<br><br>
    <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
      <button id="restart-deck-btn"
        style="padding:10px 18px;border:none;border-radius:6px;
        background:#2196f3;color:white;font-size:15px;cursor:pointer;">
        üîÅ Reiniciar
      </button>
      ${nextIndex < currentSelect.options.length
          ? `<button id="next-deck-btn"
            style="padding:10px 18px;border:none;border-radius:6px;
            background:#4caf50;color:white;font-size:15px;cursor:pointer;">
            ‚è≠Ô∏è Seg√ºent
          </button>`
          : ""
        }
    </div>
  `;

      document.getElementById("restart-deck-btn").addEventListener("click", () => {
        summary.removeAttribute("style");
        summary.innerHTML = "";
        cycles = 0;
        correct = 0;
        wrong = 0;
        completedPlants.clear();
        updateScoreboard();
        initDeck();
        nextPlant();
        startTimer();
      });

      const nextBtn = document.getElementById("next-deck-btn");
      if (nextBtn) {
        nextBtn.addEventListener("click", () => {
          summary.removeAttribute("style");
          summary.innerHTML = "";
          if (nextIndex < currentSelect.options.length) {
            currentSelect.selectedIndex = nextIndex;
            selectDeck();
          } else {
            summary.innerHTML = "üèÅ <b>Has completat totes les llistes!</b>";
          }
        });
      }
    }

    document.addEventListener("keydown", (e) => {
      if (e.key === "+" || e.key === "=") {
        e.preventDefault();
        const skipBtn = document.getElementById("skip-hide-btn");
        if (skipBtn) skipBtn.click();
      }
    });

  </script>

  <div id="version-tag" style="
  position: fixed;
  bottom: 6px;
  right: 8px;
  font-size: 12px;
  font-family: monospace;
  color: #bbb;
  opacity: 0.7;
  user-select: none;
  pointer-events: none;
  text-shadow: 0 0 3px #000;
">
  </div>

</body>

</html>